var movies=new Firebase("https://409728463list.firebaseIO-demo.com/list");(function(){var h=$("#template").html(),g=$("#list"),a=$("#count"),b=$("#state"),e=new Firebase("https://409728463.firebaseIO-demo.com/titles"),f=false;$("#search").click(function(){if(f){return false}f=true;i()});$("#searchtext").keydown(function(j){if(j.keyCode==13){if(f){return false}f=true;i()}});function i(){a.empty();g.empty();var k=$("#searchtext").val();if(k.replace(/\s/g,"")==""){f=false;return false}b.text("正在搜索...如果是首次搜索会比较慢，请耐心等候- -");var l=0;var m=0;var j=true;e.limit(20000).on("child_added",function(o){l++;if(l>18100&&j){setTimeout(c,1000);f=false}var p=o.val().title;if(p.indexOf(k)>-1||p.contains(k)){m++;a.html("共有"+m+"条结果。");var n=$(h);n.find(".title:first").text(p);n.find(".download:first").attr("onclick","showlinks('"+o.val().id+"')");n.attr("id",o.val().id);g.append(n);j=false;f=false;d()}})}function c(){b.text("Sorry，找不到你想要搜索的电影...");setTimeout(d,1000)}function d(){b.text("")}}());function showlinks(c){var a=false;$(".links").each(function(){a=$(this).parent().attr("id")==c;$(this).remove()});if(a){return false}var b=movies.child(c);b.once("value",function(g){var j=g.val().download;for(var f=0;f<j.length;f++){var d=j[f];var h=$("<div class='links'>");h.append($("<hr>"));h.append($("<small>").text("名称："+d.name));h.append($("<br>"));h.append($("<small>").text("清晰度："+d.format));h.append($("<br>"));h.append($("<small>").text("大小："+d.size));h.append($("<br>"));var e=$("<a>").append($("<small>").text(d.href));e.attr("href",d.href);h.append(e);$("#"+c).append(h)}})}String.prototype.contains=function(c){var b=0;for(var a=c.length-1;a>=0;a--){if(this.indexOf(c[a])>-1){b++}}return b>c.length/2};