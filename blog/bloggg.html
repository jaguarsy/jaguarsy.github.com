<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>test</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
	<link rel="stylesheet" type="text/css" href="js/themes/default/default.css">
</head>
<body>
	<div class="container">
		<p><a href="index.html">Back to Home</a></p>
		<input id="title" type="text" class="form-control" placeholder="Title">
		<br/>
		<textarea id="content" class="form-control" rows="30" placeholder="Content"></textarea>
		<small id="tip"></small>
		<button class="btn btn-default pull-right" onclick="a()">Publish!</button>
	</div>

	<script type="text/javascript" charset="utf-8" src="js/firebase.js"></script>
	<script type="text/javascript" charset="utf-8" src="js/guid.js"></script>
	<script type="text/javascript" src="js/kindeditor-min.js"></script>
	<script type="text/javascript" src="js/zh_CN.js"></script>
	<script type="text/javascript">

			var editor;
			KindEditor.ready(function(K) {
				editor = K.create('#content', {
					resizeType : 1,
					allowPreviewEmoticons : false,
					allowImageUpload : false,
					items : [
						'fontname', 'fontsize', 'code','|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
						'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
						'insertunorderedlist', '|', 'emoticons', 'image', 'link']
				});
			});
		


		var t;
		var storage = window.localStorage;
		var root = 'https://395703303blog.firebaseIO-demo.com/';
		articleRef = new Firebase(root + 'articles/');

		if(storage){
			$("content").innerHTML = storage.getItem("article");
			$("title").innerText = storage.getItem("title");
			t = setInterval(autoSave,10000);
		}

		function autoSave(){
			editor.sync('content'); //同步editor数据到textarea
			storage.setItem("article",$("content").value.toString());
			storage.setItem("title",$("title").value);

			$("tip").innerText = "草稿已保存 于 " + getTime()+$("content").value.toString();
		}

		function a(){
			clearInterval(t);
			editor.sync('content'); 
			var content = $("content").value.toString();
			var title = $("title").value;
			// content = content.replace(/</g, '&lt;')
			// 				 .replace(/>/g, '&gt;')
			// 				 .replace(/(\r)*\n/g,"<br/>")
			// 				 .replace(/\s/g,"&nbsp;");
			
			articleRef.push({
				id:Guid.NewGuid().ToString(),
				title:title, 
				content:content, 
				author:"Johnny", 
				time:getTime()
			});

			editor.html('');
			storage.setItem("article","");
			$("title").value = "";

			alert("已发布。");
		}

		function getTime(){ 
  			var date = new Date();
  			var hour = date.getHours();
  			var min_ = date.getMinutes(); 
  			var sec = date.getSeconds();
  			if(hour<10)hour="0"+hour;
  			if(min_<10)min_="0"+min_;
  			if(sec<10)sec="0"+sec;

  			return hour+"时"+min_+"分"+sec+"秒";
		}

		function $(id){
			return document.getElementById(id);
		}
	</script>
</body>
</html>


